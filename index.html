<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PontoView • Previsão do Tempo</title>

  <style>
    :root{
      --bgA:#1d4c7b; --bgB:#0b1b2b;

      --card:#ffffff;
      --line:#e7eef7;
      --chip:#f3f6fb;
      --muted:#6b7788;
      --ink:#0e1b2a;

      /* Header mais “ônibus” */
      --topA:#0b2a44;   /* base */
      --topB:#2c6aa3;   /* topo */
      --topC:#0f3d63;   /* meio */

      --radius:22px;
      --shadow:0 12px 36px rgba(0,0,0,.28);

      /* Tipos */
      --t-title: clamp(20px, 1.55vw, 34px);
      --t-sub:   clamp(12px, 0.95vw, 16px);
      --t-clock: clamp(34px, 3.05vw, 64px);
      --t-body:  clamp(14px, 1.05vw, 18px);

      /* Destaque clima atual */
      --t-temp:  clamp(96px, 7.2vw, 170px);
      --t-desc:  clamp(14px, 1.15vw, 18px);

      /* Próximos dias (compacto) */
      --t-day:   clamp(12px, 0.95vw, 16px);
      --t-minmax:clamp(14px, 1.1vw, 18px);

      /* Cards/valores */
      --t-mval:  clamp(18px, 1.35vw, 24px);

      --pad: clamp(16px, 1.4vw, 26px);
      --gap: clamp(14px, 1.2vw, 20px);

      --panelSoft:#f6f9fe;

      --anim: 420ms;
      --ease: cubic-bezier(.2,.8,.2,1);

      /* Estados térmicos */
      --cold:#2b6cb0;
      --nice:#1f7a4f;
      --hot:#c05621;

      /* Footer */
      --footerH: clamp(46px, 5.4vh, 72px);

      /* Safe padding (mais próximo do padrão do painel de ônibus) */
      --safe: clamp(16px, 2.2vw, 32px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 50% 0%, rgba(255,255,255,.10) 0%, rgba(255,255,255,0) 55%),
        radial-gradient(1200px 700px at 50% 0%, var(--bgA) 0%, var(--bgB) 60%);
      overflow:hidden;
    }

    /* FULLSCREEN COM SAFE PADDING */
    .frame{
      width:100vw;
      height:100vh;
      padding: var(--safe);
      display:flex;
    }

    .card{
      width:100%;
      height:100%;
      background:var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    /* ===== TOPBAR (padrão “ônibus”) ===== */
    .topbar{
      position:relative;
      background: linear-gradient(180deg, var(--topB) 0%, var(--topC) 42%, var(--topA) 100%);
      color:#fff;
      padding: calc(var(--pad) * 1.05);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:var(--gap);
      flex:0 0 auto;
      min-width:0;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }

    /* brilho no topo + vinheta sutil (igual “premium”) */
    .topbar::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 120px at 50% 0%, rgba(255,255,255,.22), rgba(255,255,255,0) 65%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,0) 42%);
      opacity:.95;
    }

    /* borda interna suave */
    .topbar::after{
      content:"";
      position:absolute;
      inset:10px;
      border-radius: calc(var(--radius) - 10px);
      border: 1px solid rgba(255,255,255,.10);
      pointer-events:none;
      opacity:.45;
    }

    .leftTop{
      position:relative;
      z-index:1;
      display:flex;
      align-items:center;
      gap:var(--gap);
      min-width:0;
      flex:1 1 auto;
    }

    /* badge estilo “glass” do painel de ônibus */
    .badge{
      width:clamp(46px,3.4vw,64px);
      height:clamp(46px,3.4vw,64px);
      border-radius: 16px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.22);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.18);
      display:grid;
      place-items:center;
      flex:0 0 auto;
    }
    .badge svg{width:60%; height:60%; opacity:.95}

    .titles{
      display:flex;
      flex-direction:column;
      gap:6px;
      line-height:1.05;
      min-width:0;
    }
    .titles h1{
      margin:0;
      font-size:var(--t-title);
      font-weight:900;
      letter-spacing:.04em; /* menos “espalhado” como no ônibus */
      text-transform:uppercase;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .titles .sub{
      font-size:var(--t-sub);
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      opacity:.92;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .rightTop{
      position:relative;
      z-index:1;
      text-align:right;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:max-content;
      padding-left: 10px;
    }
    .clockTop{
      font-size:var(--t-clock);
      font-weight:900;
      line-height:1;
      letter-spacing:.02em;
    }
    .updated{
      font-size:var(--t-sub);
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      opacity:.92;
    }

    /* Subbar */
    .subbar{
      background:var(--chip);
      border-bottom:1px solid var(--line);
      padding:calc(var(--pad)*.62) var(--pad);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:var(--gap);
      font-size:var(--t-sub);
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:#1c2c41;
      flex:0 0 auto;
      min-width:0;
    }
    .subbar > div{min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}

    main{
      flex:1 1 auto;
      padding:var(--pad);
      min-height:0;
      display:flex;
    }

    /* Layout */
    .layout{
      width:100%;
      display:grid;
      grid-template-columns: 1.22fr 0.78fr;
      gap: var(--gap);
      align-items: stretch;
      min-height: 0;
    }
    @media (max-aspect-ratio: 4/3){
      .layout{grid-template-columns:1fr;}
    }

    /* ===== ESQUERDA: HERO ===== */
    .nowHero{
      border:1px solid var(--line);
      border-radius: 20px;
      padding: clamp(18px, 1.6vw, 26px);
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 18px;
      min-height:0;
    }
    .heroTop{display:flex; gap: var(--gap); align-items:center; min-width:0;}
    .heroIcon{
      width: clamp(140px, 9.6vw, 220px);
      height: clamp(140px, 9.6vw, 220px);
      color:#7ea7cf;
      display:grid;
      place-items:center;
      flex:0 0 auto;
      position:relative;
    }
    .heroIcon svg{width:100%; height:100%}
    .heroText{min-width:0; display:flex; flex-direction:column; gap: 10px;}
    .heroTemp{
      font-size: var(--t-temp);
      font-weight: 260;
      letter-spacing:-0.03em;
      line-height: 0.95;
      white-space:nowrap;
    }
    .heroDesc{
      font-size: var(--t-desc);
      font-weight: 900;
      letter-spacing: .14em;
      text-transform: uppercase;
      color:#2a3a50;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .finePrint{font-size: 12px; color: var(--muted); font-weight: 700;}

    /* ===== DIREITA: SIDE SLOT ===== */
    .side{
      border:1px solid var(--line);
      border-radius: 20px;
      background: #fff;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .sideHeader{
      padding: 14px 16px;
      background: var(--panelSoft);
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex:0 0 auto;
    }
    .sideHeader .label{
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color:#3b4b62;
      white-space:nowrap;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toggleDots{display:flex; gap:8px; align-items:center;}
    .dot{width:10px; height:10px; border-radius:999px; background:#c9d7ea; transition: all var(--anim) var(--ease);}
    .dot.active{background:#2d76b9; width:22px;}

    .slot{position:relative; flex:1 1 auto; padding: 16px; min-height:0;}
    .view{
      position:absolute;
      inset: 16px;
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition: opacity var(--anim) var(--ease), transform var(--anim) var(--ease);
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height:0;
    }
    .view.active{opacity:1; transform: translateY(0); pointer-events:auto;}

    /* View A */
    .forecastCompact{display:flex; flex-direction:column; gap: 12px; min-height:0;}
    .fRow{
      background: var(--panelSoft);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      display:grid;
      grid-template-columns: 52px 46px 1fr auto;
      align-items:center;
      gap: 12px;
      user-select:none;
      min-width:0;
    }
    .fDow{font-size: var(--t-day); font-weight: 900; letter-spacing:.14em; text-transform: uppercase; color:#1a2a40;}
    .fIcon{
      width:46px; height:46px;
      border-radius: 14px;
      background:#fff;
      border:1px solid var(--line);
      display:grid; place-items:center;
      color:#7ea7cf;
    }
    .fIcon svg{width:64%; height:64%}
    .fTitle{
      font-size: var(--t-day);
      font-weight: 900;
      letter-spacing:.06em;
      text-transform: uppercase;
      color:#23344a;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .fPop{
      margin-top: 4px;
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#3b4b62;
      opacity:.9;
      white-space:nowrap;
    }
    .fMinMax{font-size: var(--t-minmax); font-weight: 900; white-space:nowrap; color:#0e1b2a;}

    /* View B */
    .panelBlock{
      background: var(--panelSoft);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height:0;
    }
    .ddTop{display:flex; align-items:center; justify-content:space-between; gap: 12px; min-width:0;}
    .ddLeft{display:flex; align-items:center; gap: 12px; min-width:0;}
    .ddIcon{
      width:64px; height:64px;
      border-radius: 18px;
      background:#fff;
      border:1px solid var(--line);
      display:grid; place-items:center;
      color:#7ea7cf;
      flex:0 0 auto;
    }
    .ddIcon svg{width:70%; height:70%}
    .ddTitle{min-width:0; display:flex; flex-direction:column; gap: 6px;}
    .ddDow{font-size: 12px; font-weight: 900; letter-spacing:.14em; text-transform: uppercase; color:#1a2a40; white-space:nowrap;}
    .ddCond{
      font-size: var(--t-body);
      font-weight: 900;
      letter-spacing:.08em;
      text-transform: uppercase;
      color:#23344a;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .ddTemps{font-size: clamp(22px, 1.8vw, 30px); font-weight: 900; white-space:nowrap; color:#0e1b2a;}

    .metricsSide{display:grid; grid-template-columns: 1fr 1fr; gap: 12px;}
    .mCard{
      background:#fff;
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      min-height: 64px;
      min-width:0;
    }
    .mLabel{font-size: 11px; font-weight: 900; letter-spacing:.12em; text-transform: uppercase; color:#3b4b62; white-space:nowrap;}
    .mVal{font-size: var(--t-mval); font-weight: 900; white-space:nowrap; color:#0e1b2a;}

    /* Sensação térmica */
    .feelWrap{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      background:#fff;
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      min-width:0;
    }
    .feelLeft{display:flex; align-items:center; gap: 12px; min-width:0;}
    .thermo{
      width: 46px;
      height: 46px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: #fff;
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
      color: var(--nice);
      flex:0 0 auto;
    }
    .thermo::after{
      content:"";
      position:absolute;
      inset: 0;
      opacity:.12;
      background: currentColor;
      transform: scale(1);
      animation: pulse 2.6s var(--ease) infinite;
    }
    @keyframes pulse{
      0%,100%{opacity:.08; transform:scale(1)}
      50%{opacity:.18; transform:scale(1.08)}
    }
    .thermo svg{width:56%; height:56%; position:relative; z-index:1;}
    .feelText{display:flex; flex-direction:column; gap: 4px; min-width:0;}
    .feelState{font-size: 11px; font-weight: 900; letter-spacing:.14em; text-transform: uppercase; color:#3b4b62; white-space:nowrap;}
    .feelHint{
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 280px;
    }
    .feelVal{font-size: var(--t-mval); font-weight: 900; white-space:nowrap;}

    .feel-cold .thermo{ color: var(--cold); }
    .feel-nice .thermo{ color: var(--nice); }
    .feel-hot  .thermo{ color: var(--hot); }

    /* Footer padrão */
    .pvFooter{
      flex:0 0 auto;
      height: var(--footerH);
      display:flex;
      align-items:center;
      justify-content:flex-end;
      padding: 10px 16px;
      border-top:1px solid var(--line);
      background: transparent;
      gap: 12px;
    }
    .pvFooterBrand{display:flex; align-items:center; gap:10px; opacity:.88;}
    .pvFooterBrand img{height: clamp(16px, 2.4vh, 22px); width:auto; display:block;}
    .pvFooterBrand .pvSmall{
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#3b4b62;
      white-space:nowrap;
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="card" id="panel"
      data-title="PREVISÃO DO TEMPO"
      data-subtitle="COLATINA - ES"
      data-subleft="CLIMA ATUAL + PRÓXIMOS DIAS"
      data-subright="FONTE • OPEN-METEO">

      <header class="topbar">
        <div class="leftTop">
          <div class="badge" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 17.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 10.2 3.8 3.8 0 0 0 7 17.5h13z"/>
            </svg>
          </div>
          <div class="titles">
            <h1 id="title"></h1>
            <div class="sub" id="subtitle"></div>
          </div>
        </div>
        <div class="rightTop">
          <div class="clockTop" id="clockTop">--:--</div>
          <div class="updated" id="updated">ATUALIZADO • --:--</div>
        </div>
      </header>

      <div class="subbar">
        <div id="subLeft"></div>
        <div id="subRight"></div>
      </div>

      <main>
        <div class="layout">

          <section class="nowHero">
            <div class="heroTop">
              <div class="heroIcon" id="nowIcon" aria-hidden="true"></div>
              <div class="heroText">
                <div class="heroTemp" id="tempNow">--°</div>
                <div class="heroDesc" id="descNow">CARREGANDO...</div>
              </div>
            </div>
            <div class="finePrint" id="finePrint">—</div>
          </section>

          <aside class="side">
            <div class="sideHeader">
              <div class="label" id="sideLabel">PRÓXIMOS DIAS</div>
              <div class="toggleDots" aria-hidden="true">
                <div class="dot active" id="dotA"></div>
                <div class="dot" id="dotB"></div>
              </div>
            </div>

            <div class="slot">
              <div class="view active" id="viewA">
                <div class="forecastCompact" id="forecastList"></div>
              </div>

              <div class="view" id="viewB">
                <div class="panelBlock">
                  <div class="ddTop">
                    <div class="ddLeft">
                      <div class="ddIcon" id="ddIcon" aria-hidden="true"></div>
                      <div class="ddTitle">
                        <div class="ddDow" id="ddDow">HOJE</div>
                        <div class="ddCond" id="ddCond">—</div>
                      </div>
                    </div>
                    <div class="ddTemps" id="ddTemps">—</div>
                  </div>

                  <div class="metricsSide">
                    <div class="mCard">
                      <div class="mLabel">VENTO</div>
                      <div class="mVal" id="wind">-- km/h</div>
                    </div>
                    <div class="mCard">
                      <div class="mLabel">UMIDADE</div>
                      <div class="mVal" id="humidity">--%</div>
                    </div>
                    <div class="mCard">
                      <div class="mLabel">CHUVA</div>
                      <div class="mVal" id="rain">-- mm</div>
                    </div>
                    <div class="mCard">
                      <div class="mLabel">CHUVA %</div>
                      <div class="mVal" id="ddPop">--%</div>
                    </div>
                  </div>

                  <div class="feelWrap" id="feelWrap">
                    <div class="feelLeft">
                      <div class="thermo" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M14 14.76V5a2 2 0 0 0-4 0v9.76a4 4 0 1 0 4 0z"/>
                        </svg>
                      </div>
                      <div class="feelText">
                        <div class="feelState" id="feelState">SENSAÇÃO</div>
                        <div class="feelHint" id="feelHint">—</div>
                      </div>
                    </div>
                    <div class="feelVal" id="feels">--°C</div>
                  </div>

                </div>
              </div>
            </div>
          </aside>

        </div>
      </main>

      <footer class="pvFooter" aria-label="PontoView">
        <div class="pvFooterBrand">
          <span class="pvSmall">PontoView</span>
          <img src="./assets/logo-pontoview.png" alt="Logo PontoView" />
        </div>
      </footer>
    </div>
  </div>

  <script>
    // ========= CONFIG =========
    const CITY = { name: "Colatina - ES", lat: -19.538, lon: -40.626 };
    const ROTATE_MS = 11000;

    // ========= HEADER =========
    const panel = document.getElementById("panel");
    document.getElementById("title").textContent = panel.dataset.title || "";
    document.getElementById("subtitle").textContent = panel.dataset.subtitle || CITY.name;
    document.getElementById("subLeft").textContent = panel.dataset.subleft || "";
    document.getElementById("subRight").textContent = panel.dataset.subright || "";

    // clock
    function hhmm(d=new Date()){
      return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
    }
    function tickClock(){
      const t = hhmm();
      document.getElementById("clockTop").textContent = t;
      document.getElementById("updated").textContent = `ATUALIZADO • ${t}`;
    }
    tickClock();
    setInterval(tickClock, 1000*10);

    // ========= ÍCONES (SEM animação) =========
    function svgCloud(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 17.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 10.2 3.8 3.8 0 0 0 7 17.5h13z"/>
      </svg>`; }

    function svgSun(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="4"></circle>
        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path>
      </svg>`; }

    function svgRain(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h13z"/>
        <path d="M8 19l-1 2"></path>
        <path d="M12 19l-1 2"></path>
        <path d="M16 19l-1 2"></path>
      </svg>`; }

    function svgStorm(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h9"/>
        <path d="M13 14l-2 4h3l-2 4"></path>
      </svg>`; }

    function svgPartly(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="8" cy="8" r="3"></circle>
        <path d="M8 2v1M8 13v1M2 8h1M13 8h1M3.5 3.5l.7.7M11.8 11.8l.7.7M3.5 12.5l.7-.7M11.8 4.2l.7-.7"></path>
        <path d="M20 17.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 8.3 10.1 3.8 3.8 0 0 0 9 17.5h11z"/>
      </svg>`; }

    function codeToMeta(code){
      if (code === 0) return { icon: svgSun(), text: "Ensolarado" };
      if (code === 1 || code === 2) return { icon: svgPartly(), text: "Parcialmente nublado" };
      if (code === 3) return { icon: svgCloud(), text: "Nublado" };
      if ([45,48].includes(code)) return { icon: svgCloud(), text: "Neblina" };
      if ([51,53,55,61,63,65,80,81,82].includes(code)) return { icon: svgRain(), text: "Chuva" };
      if ([95,96,99].includes(code)) return { icon: svgStorm(), text: "Tempestade" };
      if ([71,73,75,77,85,86].includes(code)) return { icon: svgCloud(), text: "Neve" };
      return { icon: svgCloud(), text: "Tempo" };
    }

    function dowPT(dateStr){
      const d = new Date(dateStr + "T12:00:00");
      const map = ["DOM","SEG","TER","QUA","QUI","SEX","SÁB"];
      return map[d.getDay()];
    }

    // ========= ROTATOR =========
    const viewA = document.getElementById("viewA");
    const viewB = document.getElementById("viewB");
    const dotA = document.getElementById("dotA");
    const dotB = document.getElementById("dotB");
    const sideLabel = document.getElementById("sideLabel");
    let showingA = true;

    function showA(){
      showingA = true;
      viewA.classList.add("active");
      viewB.classList.remove("active");
      dotA.classList.add("active");
      dotB.classList.remove("active");
      sideLabel.textContent = "PRÓXIMOS DIAS";
    }
    function showB(){
      showingA = false;
      viewB.classList.add("active");
      viewA.classList.remove("active");
      dotB.classList.add("active");
      dotA.classList.remove("active");
      sideLabel.textContent = "HOJE";
    }
    setInterval(()=>{ showingA ? showB() : showA(); }, ROTATE_MS);

    // ========= ESTADO / RENDER =========
    let dailyData = null;
    const selectedIndex = 0; // HOJE (fixo)
    let currentFeels = null;

    function renderForecastList(){
      const list = document.getElementById("forecastList");
      list.innerHTML = "";
      if(!dailyData) return;

      const { time, weather_code, temperature_2m_max, temperature_2m_min, precipitation_probability_max } = dailyData;

      const start = 1;
      const end = Math.min(time.length, 5);

      for(let i=start; i<end; i++){
        const meta = codeToMeta(weather_code[i]);
        const pop = precipitation_probability_max?.[i] ?? 0;
        const max = Math.round(temperature_2m_max[i]);
        const min = Math.round(temperature_2m_min[i]);

        const row = document.createElement("div");
        row.className = "fRow";
        row.innerHTML = `
          <div class="fDow">${dowPT(time[i])}</div>
          <div class="fIcon" aria-hidden="true">${meta.icon}</div>
          <div style="min-width:0;">
            <div class="fTitle">${meta.text.toUpperCase()}</div>
            <div class="fPop">CHUVA ${pop}%</div>
          </div>
          <div class="fMinMax">${max}° / ${min}°</div>
        `;
        list.appendChild(row);
      }
    }

    function thermalState(feels){
      if (feels <= 18) return { cls:"feel-cold", label:"FRIO", hint:"Leve um agasalho." };
      if (feels <= 27) return { cls:"feel-nice", label:"AGRADÁVEL", hint:"Clima confortável." };
      return { cls:"feel-hot", label:"CALOR", hint:"Hidrate-se e evite sol forte." };
    }

    function renderTodayDetails(){
      if(!dailyData) return;

      const { time, weather_code, temperature_2m_max, temperature_2m_min, precipitation_probability_max } = dailyData;

      const meta = codeToMeta(weather_code[selectedIndex]);
      const date = time[selectedIndex];
      const pop = precipitation_probability_max?.[selectedIndex] ?? 0;
      const max = Math.round(temperature_2m_max[selectedIndex]);
      const min = Math.round(temperature_2m_min[selectedIndex]);

      document.getElementById("ddIcon").innerHTML = meta.icon;
      document.getElementById("ddCond").textContent = meta.text.toUpperCase();
      document.getElementById("ddTemps").textContent = `${max}° / ${min}°`;
      document.getElementById("ddPop").textContent = `${pop}%`;
      document.getElementById("ddDow").textContent = `HOJE • ${dowPT(date)}`;

      if (typeof currentFeels === "number"){
        const st = thermalState(currentFeels);
        const wrap = document.getElementById("feelWrap");
        wrap.classList.remove("feel-cold","feel-nice","feel-hot");
        wrap.classList.add(st.cls);
        document.getElementById("feelState").textContent = `SENSAÇÃO • ${st.label}`;
        document.getElementById("feelHint").textContent = st.hint;
      }
    }

    async function loadWeather(){
      const url = new URL("https://api.open-meteo.com/v1/forecast");
      url.searchParams.set("latitude", CITY.lat);
      url.searchParams.set("longitude", CITY.lon);
      url.searchParams.set("timezone", "America/Sao_Paulo");
      url.searchParams.set("current", "temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m");
      url.searchParams.set("daily", "weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max");
      url.searchParams.set("forecast_days", "5");

      const res = await fetch(url.toString(), { cache:"no-store" });
      if(!res.ok) throw new Error("Falha ao carregar clima");
      const data = await res.json();

      const cur = data.current;
      const now = codeToMeta(cur.weather_code);

      document.getElementById("tempNow").textContent = `${Math.round(cur.temperature_2m)}°`;
      document.getElementById("descNow").textContent = now.text.toUpperCase();
      document.getElementById("nowIcon").innerHTML = now.icon;

      document.getElementById("wind").textContent = `${Math.round(cur.wind_speed_10m)} km/h`;
      document.getElementById("humidity").textContent = `${Math.round(cur.relative_humidity_2m)}%`;
      document.getElementById("rain").textContent = `${Number(cur.precipitation).toFixed(1)} mm`;
      document.getElementById("feels").textContent = `${Math.round(cur.apparent_temperature)}°C`;
      currentFeels = Math.round(cur.apparent_temperature);

      document.getElementById("finePrint").textContent = `Local: ${CITY.name}`;

      dailyData = data.daily;
      renderForecastList();
      renderTodayDetails();
    }

    showA();
    loadWeather().catch(err=>{
      document.getElementById("descNow").textContent = "SEM CONEXÃO";
      document.getElementById("finePrint").textContent = "Sem conexão com a internet.";
      console.error(err);
    });
    setInterval(()=>loadWeather().catch(()=>{}), 1000*60*20);
  </script>
</body>
</html>
