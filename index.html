<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PontoView • Previsão do Tempo</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800;900&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bgA:#1d4c7b; --bgB:#0b1b2b;

      --card:#ffffff;
      --line:#e7eef7;
      --chip:#f3f6fb;
      --muted:#6b7788;
      --ink:#0e1b2a;

      --topA:#0b2a44;
      --topB:#2c6aa3;
      --topC:#0f3d63;

      --radius:22px;
      --shadow:0 12px 36px rgba(0,0,0,.28);

      --t-title: clamp(20px, 1.55vw, 34px);
      --t-sub:   clamp(12px, 0.95vw, 16px);
      --t-clock: clamp(34px, 3.05vw, 64px);

      --pad: clamp(16px, 1.4vw, 26px);
      --gap: clamp(14px, 1.2vw, 20px);

      --panelSoft:#f6f9fe;

      --anim: 520ms;
      --ease: cubic-bezier(.2,.8,.2,1);

      --footerH: clamp(52px, 6vh, 82px);
      --safe: clamp(16px, 2.2vw, 32px);

      /* ALERT forte */
      --warnBg:#fff0c2;
      --warnInk:#5a3a00;
      --warnLine:#f2c66a;
      --warnHot:#f59e0b;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 50% 0%, rgba(255,255,255,.10) 0%, rgba(255,255,255,0) 55%),
        radial-gradient(1200px 700px at 50% 0%, var(--bgA) 0%, var(--bgB) 60%);
      overflow:hidden;
    }

    .frame{
      width:100vw;
      height:100vh;
      padding: var(--safe);
      display:flex;
    }

    .card{
      width:100%;
      height:100%;
      background:var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    /* ===== TOPBAR ===== */
    .topbar{
      position:relative;
      background: linear-gradient(180deg, var(--topB) 0%, var(--topC) 42%, var(--topA) 100%);
      color:#fff;
      padding: calc(var(--pad) * 1.05);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:var(--gap);
      flex:0 0 auto;
      min-width:0;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .topbar::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 120px at 50% 0%, rgba(255,255,255,.22), rgba(255,255,255,0) 65%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,0) 42%);
      opacity:.95;
    }
    .topbar::after{
      content:"";
      position:absolute;
      inset:10px;
      border-radius: calc(var(--radius) - 10px);
      border: 1px solid rgba(255,255,255,.10);
      pointer-events:none;
      opacity:.45;
    }

    .leftTop{
      position:relative;
      z-index:1;
      display:flex;
      align-items:center;
      gap:var(--gap);
      min-width:0;
      flex:1 1 auto;
    }
    .badge{
      width:clamp(46px,3.4vw,64px);
      height:clamp(46px,3.4vw,64px);
      border-radius: 16px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.22);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.18);
      display:grid;
      place-items:center;
      flex:0 0 auto;
    }
    .badge svg{width:60%; height:60%; opacity:.95}

    .titles{
      display:flex;
      flex-direction:column;
      gap:6px;
      line-height:1.05;
      min-width:0;
    }
    .titles h1{
      margin:0;
      font-size:var(--t-title);
      font-weight:900;
      letter-spacing:.04em;
      text-transform:uppercase;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .titles .sub{
      font-size:var(--t-sub);
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      opacity:.92;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .rightTop{
      position:relative;
      z-index:1;
      text-align:right;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:max-content;
      padding-left: 10px;
    }
    .clockTop{
      font-size:var(--t-clock);
      font-weight:900;
      line-height:1;
      letter-spacing:.02em;
    }

    /* ===== SUBBAR ===== */
    .subbar{
      background:var(--chip);
      border-bottom:1px solid var(--line);
      padding:calc(var(--pad)*.62) var(--pad);
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      gap:var(--gap);
      font-size:var(--t-sub);
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:#1c2c41;
      flex:0 0 auto;
      min-width:0;
    }
    .subbar .left{justify-self:start; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .subbar .center{justify-self:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .subbar .right{
      justify-self:end;
      display:flex;
      align-items:flex-end;
      justify-content:flex-end;
      gap:14px;
      min-width:0;
    }

    /* Fonte fica aqui (abaixo do relógio visualmente, porque está na subbar à direita) */
    .sourceTag{
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#3b4b62;
      opacity:.95;
      white-space:nowrap;
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid #e7e9ee;
      box-shadow: 0 8px 18px rgba(0,0,0,.04);
    }

    /* ALERT bem sinalizado */
    .alertPill{
      display:none;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border-radius:999px;
      background: var(--warnBg);
      border:2px solid var(--warnLine);
      color: var(--warnInk);
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.10em;
      text-transform:uppercase;
      white-space:nowrap;
      box-shadow:
        0 10px 24px rgba(245,158,11,.18),
        0 0 0 0 rgba(245,158,11,.35);
      animation: alertGlow 1.2s var(--ease) infinite;
    }
    .alertPill.show{display:inline-flex;}
    .alertPill svg{width:18px; height:18px; flex:0 0 auto;}
    .alertPulse{
      width:10px; height:10px; border-radius:999px;
      background:var(--warnHot);
      box-shadow: 0 0 0 0 rgba(245,158,11,.45);
      animation: alertPulse 1.2s var(--ease) infinite;
    }
    @keyframes alertPulse{
      0%{box-shadow:0 0 0 0 rgba(245,158,11,.45)}
      70%{box-shadow:0 0 0 14px rgba(245,158,11,0)}
      100%{box-shadow:0 0 0 0 rgba(245,158,11,0)}
    }
    @keyframes alertGlow{
      0%,100%{box-shadow: 0 10px 24px rgba(245,158,11,.18), 0 0 0 0 rgba(245,158,11,.25)}
      50%{box-shadow: 0 14px 30px rgba(245,158,11,.26), 0 0 0 6px rgba(245,158,11,.08)}
    }

    /* MAIN */
    main{
      flex:1 1 auto;
      padding:var(--pad);
      min-height:0;
      display:flex;
    }
    .layout{
      width:100%;
      display:grid;
      grid-template-columns: 1.22fr 0.78fr;
      gap: var(--gap);
      align-items: stretch;
      min-height: 0;
    }
    @media (max-aspect-ratio: 4/3){
      .layout{grid-template-columns:1fr;}
    }

    /* LEFT CARD (AGORA) */
    .nowCard{
      border:1px solid var(--line);
      border-radius: 20px;
      background:#fff;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .nowHead{
      padding: 18px 18px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      min-width:0;
      flex:0 0 auto;
    }
    .city{
      font-size: 18px;
      font-weight: 900;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#1a2a40;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Centro com ícone + temperatura */
    .nowCenter{
      padding: 8px 18px 0;
      flex:1 1 auto;
      min-height:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .nowWrap{
      width:100%;
      max-width: 760px;
      display:grid;
      grid-template-columns: clamp(90px, 9vw, 150px) 1fr;
      align-items:center;
      gap: clamp(14px, 1.6vw, 22px);
    }
    .nowIcon{
      width: clamp(90px, 9vw, 150px);
      height: clamp(90px, 9vw, 150px);
      display:grid;
      place-items:center;
      color:#0f3d63;
      opacity:.95;
    }
    .nowIcon svg{width:100%; height:100%}
    .tempBlock{min-width:0}
    .tempBig{
      font-size: clamp(78px, 7.2vw, 150px);
      font-weight: 900;
      letter-spacing:-0.03em;
      line-height: .92;
      white-space:nowrap;
    }
    .tempBig small{font-size:.42em; font-weight: 900; opacity:.92}
    .condLine{
      margin-top: 10px;
      font-size: 14px;
      font-weight: 900;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:#2a3a50;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* Base com métricas (fixo embaixo) */
    .nowBottom{
      padding: 14px 18px 16px;
      border-top:1px solid var(--line);
      background:#fff;
      flex:0 0 auto;
    }
    .metricsRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      align-items:stretch;
    }
    .mCard{
      background:#f1f3f5;
      border:1px solid #eceff3;
      border-radius: 14px;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      min-width:0;
    }
    .mLeft{display:flex; align-items:center; gap:10px; min-width:0;}
    .mIcon{
      width:34px; height:34px;
      border-radius: 12px;
      background:#fff;
      border:1px solid #e7e9ee;
      display:grid; place-items:center;
      color:#1a2a40;
      opacity:.9;
      flex:0 0 auto;
    }
    .mIcon svg{width:62%; height:62%}
    .mLabel{
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:#3b4b62;
      white-space:nowrap;
    }
    .mVal{
      font-size: 18px;
      font-weight: 900;
      white-space:nowrap;
      color:#0e1b2a;
    }

    /* RIGHT SIDE (alternância) */
    .side{
      border:1px solid var(--line);
      border-radius: 20px;
      background: #fff;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .sideHeader{
      padding: 14px 16px;
      background: var(--panelSoft);
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex:0 0 auto;
    }
    .sideHeader .label{
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color:#3b4b62;
      white-space:nowrap;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toggleDots{display:flex; gap:8px; align-items:center;}
    .dot{width:10px; height:10px; border-radius:999px; background:#c9d7ea; transition: all 420ms var(--ease);}
    .dot.active{background:#2d76b9; width:22px;}

    .slot{position:relative; flex:1 1 auto; padding: 16px; min-height:0; background:#fff;}
    .view{
      position:absolute;
      inset: 16px;
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition: opacity var(--anim) var(--ease), transform var(--anim) var(--ease);
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height:0;
    }
    .view.active{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    /* ===== Próximos dias ===== */
    .forecastList{
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height:0;
      overflow:auto;                  /* permite rolagem */
      overscroll-behavior: contain;
      scrollbar-width: none;          /* Firefox */
    }
    .forecastList::-webkit-scrollbar{ width:0; height:0; } /* Chrome */

    .fRow{
      background:#f1f3f5;
      border:1px solid #eceff3;
      border-radius: 14px;
      padding: 12px;
      display:grid;
      grid-template-columns: 56px 44px 1fr auto; /* DOW | ÍCONE | BADGE/TEXTO | TEMPS */
      align-items:center;
      gap: 12px;
      min-width:0;
    }
    .fDow{
      font-size: 14px;
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color:#1a2a40;
      white-space:nowrap;
    }
    .fIcon{
      width:44px; height:44px;
      border-radius: 14px;
      background:#fff;
      border:1px solid #e7e9ee;
      display:grid;
      place-items:center;
      color:#0f3d63;
      opacity:.95;
      flex:0 0 auto;
    }
    .fIcon svg{width:70%; height:70%}

    .fMid{min-width:0; display:flex; flex-direction:column; gap:6px;}

    /* Badge sem repetir ícone */
    .fBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid #e7e9ee;
      width: fit-content;
      max-width: 100%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.08em;
      text-transform: uppercase;
      color:#23344a;
    }

    .fSub{
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#3b4b62;
      opacity:.92;
      white-space:nowrap;
    }

    /* Máx/mín na horizontal */
    .fTemps{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      white-space:nowrap;
      font-weight: 900;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 8px 12px;
      border-radius: 999px;
      background:#fff;
      border:1px solid #e7e9ee;
      font-size: 12px;
      font-weight: 900;
      color:#0e1b2a;
      min-width: 44px;
    }

    /* Detalhes de hoje */
    .detailCard{
      border:1px solid #eef2f7;
      border-radius: 16px;
      padding: 14px;
      background:#fff;
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height:0;
    }
    .bigMinMax{
      display:flex;
      gap: 18px;
      align-items:flex-end;
      justify-content:flex-start;
      padding: 6px 2px 4px;
    }
    .mmBlock{display:flex; align-items:baseline; gap:10px;}
    .mmNum{
      font-size: clamp(46px, 3.6vw, 64px);
      font-weight: 900;
      letter-spacing:-0.02em;
      line-height:1;
      color:#0e1b2a;
      white-space:nowrap;
    }
    .mmLbl{
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#7a8697;
      white-space:nowrap;
    }
    .detailPills{display:flex; gap:10px; flex-wrap:wrap;}
    .pill svg{width:16px;height:16px;opacity:.9}

    /* FOOTER */
    .pvFooter{
      flex:0 0 auto;
      height: var(--footerH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 16px;
      border-top:1px solid var(--line);
      background: transparent;
      gap: 12px;
      min-width:0;
    }
    .footLeft{
      display:flex;
      align-items:center;
      min-width:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .footMeta{
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#3b4b62;
      opacity:.95;
    }

    /* Logo no canto direito */
    .pvBrand{
      display:flex;
      align-items:center;
      gap:10px;
      opacity:.92;
      flex:0 0 auto;
      margin-left:auto;
    }
    .pvBrand img{
      height: clamp(16px, 2.4vh, 22px);
      width:auto;
      display:block;
    }

    /* ===== Responsividade vertical ===== */
    @media (max-aspect-ratio: 3/4){
      .layout{grid-template-columns:1fr;}
      .metricsRow{grid-template-columns:1fr;}
      .nowWrap{grid-template-columns: 1fr; justify-items:center; text-align:center;}
      .tempBlock{display:flex; flex-direction:column; align-items:center;}
      .nowCenter{padding-top: 12px;}
      .subbar{grid-template-columns: 1fr auto; grid-template-rows:auto auto; row-gap: 10px;}
      .subbar .center{grid-column:1 / -1; order:2; justify-self:center; opacity:.9}
      .subbar .left{order:1}
      .subbar .right{order:3; justify-self:end; flex-wrap:wrap;}
    }

    /* ===== ÍCONE principal animado (somente no AGORA) ===== */
    .animFloat{
      animation: floaty 2.8s var(--ease) infinite;
      transform-origin: 50% 50%;
    }
    @keyframes floaty{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-6px)}
    }
    .animRainDrop{animation: drop 1.2s linear infinite;}
    @keyframes drop{
      0%{transform: translateY(-2px); opacity:.2}
      35%{opacity:1}
      100%{transform: translateY(10px); opacity:0}
    }
    .animLightning{
      animation: flash 1.1s var(--ease) infinite;
      transform-origin: 50% 50%;
    }
    @keyframes flash{
      0%,60%,100%{opacity:1; transform: scale(1)}
      30%{opacity:.2; transform: scale(.98)}
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="card" id="panel"
      data-title="PREVISÃO DO TEMPO"
      data-subtitle="LOCAL • ES">

      <header class="topbar">
        <div class="leftTop">
          <div class="badge" aria-hidden="true" id="hdrIcon"></div>
          <div class="titles">
            <h1 id="title"></h1>
            <div class="sub" id="subtitle"></div>
          </div>
        </div>
        <div class="rightTop">
          <div class="clockTop" id="clockTop">--:--</div>
        </div>
      </header>

      <div class="subbar">
        <div class="left" id="subLeft">AGORA</div>
        <div class="center" id="subCenter">HOJE • PRÓXIMOS DIAS</div>
        <div class="right">
          <div class="sourceTag" id="subSource">FONTE • OPEN-METEO</div>

          <div class="alertPill" id="alertTop">
            <span class="alertPulse" aria-hidden="true"></span>
            <span id="alertIcon" aria-hidden="true"></span>
            <span id="alertTopText">ALERTA • —</span>
          </div>
        </div>
      </div>

      <main>
        <div class="layout">

          <!-- LEFT: AGORA -->
          <section class="nowCard">
            <div class="nowHead">
              <div class="city" id="cityName">—</div>
            </div>

            <div class="nowCenter">
              <div class="nowWrap">
                <div class="nowIcon" id="nowIcon" aria-hidden="true"></div>
                <div class="tempBlock">
                  <div class="tempBig" id="tempNow">--<small>°C</small></div>
                  <div class="condLine" id="descNow">CARREGANDO…</div>
                </div>
              </div>
            </div>

            <div class="nowBottom">
              <div class="metricsRow">
                <div class="mCard">
                  <div class="mLeft">
                    <div class="mIcon" aria-hidden="true" id="icFeel"></div>
                    <div class="mLabel">SENSAÇÃO</div>
                  </div>
                  <div class="mVal" id="feels">--°</div>
                </div>

                <div class="mCard">
                  <div class="mLeft">
                    <div class="mIcon" aria-hidden="true" id="icWind"></div>
                    <div class="mLabel">VENTO</div>
                  </div>
                  <div class="mVal" id="wind">-- km/h</div>
                </div>

                <div class="mCard">
                  <div class="mLeft">
                    <div class="mIcon" aria-hidden="true" id="icHum"></div>
                    <div class="mLabel">UMIDADE</div>
                  </div>
                  <div class="mVal" id="humidity">--%</div>
                </div>
              </div>
            </div>
          </section>

          <!-- RIGHT: Alterna Próximos dias <-> Detalhes hoje -->
          <aside class="side">
            <div class="sideHeader">
              <div class="label" id="sideLabel">PRÓXIMOS DIAS</div>
              <div class="toggleDots" aria-hidden="true">
                <div class="dot active" id="dotA"></div>
                <div class="dot" id="dotB"></div>
              </div>
            </div>

            <div class="slot">
              <!-- View A: Próximos dias -->
              <div class="view active" id="viewA">
                <div class="forecastList" id="forecastList"></div>
              </div>

              <!-- View B: Detalhes de hoje -->
              <div class="view" id="viewB">
                <div class="detailCard">

                  <div class="bigMinMax">
                    <div class="mmBlock">
                      <div class="mmNum" id="tMax">--°</div>
                      <div class="mmLbl">máx</div>
                    </div>
                    <div class="mmBlock">
                      <div class="mmNum" id="tMin">--°</div>
                      <div class="mmLbl">mín</div>
                    </div>
                  </div>

                  <div class="detailPills">
                    <div class="pill" id="pillRain"><span id="rainMm">-- mm</span></div>
                    <div class="pill" id="pillPop"><span id="popPct">--% chuva</span></div>
                    <div class="pill" id="pillCond"><span id="condTxt">—</span></div>
                  </div>

                </div>
              </div>

            </div>
          </aside>

        </div>
      </main>

      <footer class="pvFooter" aria-label="Rodapé PontoView">
        <div class="footLeft">
          <div class="footMeta" id="footUpdated">ATUALIZADO • —</div>
        </div>

        <div class="pvBrand" aria-label="PontoView">
          <img src="./assets/logo-pontoview.png" alt="Logo PontoView" />
        </div>
      </footer>
    </div>
  </div>

  <script>
    const FALLBACK_CITY = { name: "Vitória - ES", lat: -20.3155, lon: -40.3128, state: "ES" };
    const ROTATE_MS = 11000;
    const WEATHER_REFRESH_MIN = 25;
    const TZ = "America/Sao_Paulo";

    let CITY = { ...FALLBACK_CITY };

    function hhmm(d=new Date()){
      return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
    }
    function ddmm_hhmm(d=new Date()){
      const dd = String(d.getDate()).padStart(2,"0");
      const mm = String(d.getMonth()+1).padStart(2,"0");
      return `${dd}/${mm}, ${hhmm(d)}`;
    }

    const panel = document.getElementById("panel");
    document.getElementById("title").textContent = panel.dataset.title || "PREVISÃO DO TEMPO";
    document.getElementById("subtitle").textContent = panel.dataset.subtitle || "LOCAL • ES";

    function tickClock(){
      document.getElementById("clockTop").textContent = hhmm();
    }
    tickClock();
    setInterval(tickClock, 1000 * 10);

    function svgCloud(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 17.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 10.2 3.8 3.8 0 0 0 7 17.5h13z"/>
      </svg>`; }
    function svgSun(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="4"></circle>
        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path>
      </svg>`; }
    function svgRain(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h13z"/>
        <path d="M8 19l-1 2"></path>
        <path d="M12 19l-1 2"></path>
        <path d="M16 19l-1 2"></path>
      </svg>`; }
    function svgStorm(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h9"/>
        <path d="M13 14l-2 4h3l-2 4"></path>
      </svg>`; }
    function svgPartly(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="8" cy="8" r="3"></circle>
        <path d="M8 2v1M8 13v1M2 8h1M13 8h1M3.5 3.5l.7.7M11.8 11.8l.7.7M3.5 12.5l.7-.7M11.8 4.2l.7-.7"></path>
        <path d="M20 17.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 8.3 10.1 3.8 3.8 0 0 0 9 17.5h11z"/>
      </svg>`; }
    function svgThermo(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 14.76V5a2 2 0 0 0-4 0v9.76a4 4 0 1 0 4 0z"/>
      </svg>`; }
    function svgWind(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 12h11"/>
        <path d="M14 12a3 3 0 1 0-3-3"/>
        <path d="M3 18h15"/>
        <path d="M18 18a3 3 0 1 0-3-3"/>
      </svg>`; }
    function svgDrop(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 2s6 7 6 12a6 6 0 0 1-12 0c0-5 6-12 6-12z"/>
      </svg>`; }
    function svgWarn(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10.3 3.2 1.8 18a2 2 0 0 0 1.7 3h17a2 2 0 0 0 1.7-3L13.7 3.2a2 2 0 0 0-3.4 0z"/>
        <path d="M12 9v4"/>
        <path d="M12 17h.01"/>
      </svg>`; }

    document.getElementById("hdrIcon").innerHTML = svgCloud();
    document.getElementById("icFeel").innerHTML = svgThermo();
    document.getElementById("icWind").innerHTML = svgWind();
    document.getElementById("icHum").innerHTML = svgDrop();

    function codeToMeta(code){
      if (code === 0) return { icon: svgSun(), text: "Ensolarado", kind:"sun" };
      if (code === 1 || code === 2) return { icon: svgPartly(), text: "Parcialmente nublado", kind:"partly" };
      if (code === 3) return { icon: svgCloud(), text: "Nublado", kind:"cloud" };
      if ([45,48].includes(code)) return { icon: svgCloud(), text: "Neblina", kind:"cloud" };
      if ([51,53,55,61,63,65,80,81,82].includes(code)) return { icon: svgRain(), text: "Chuva", kind:"rain" };
      if ([95,96,99].includes(code)) return { icon: svgStorm(), text: "Tempestade", kind:"storm" };
      if ([71,73,75,77,85,86].includes(code)) return { icon: svgCloud(), text: "Neve", kind:"cloud" };
      return { icon: svgCloud(), text: "Tempo", kind:"cloud" };
    }

    function dowPT(dateStr){
      const d = new Date(dateStr + "T12:00:00");
      const map = ["DOM","SEG","TER","QUA","QUI","SEX","SÁB"];
      return map[d.getDay()];
    }

    const viewA = document.getElementById("viewA");
    const viewB = document.getElementById("viewB");
    const dotA = document.getElementById("dotA");
    const dotB = document.getElementById("dotB");
    const sideLabel = document.getElementById("sideLabel");
    let showingA = true;

    function showA(){
      showingA = true;
      viewA.classList.add("active");
      viewB.classList.remove("active");
      dotA.classList.add("active");
      dotB.classList.remove("active");
      sideLabel.textContent = "PRÓXIMOS DIAS";
    }
    function showB(){
      showingA = false;
      viewB.classList.add("active");
      viewA.classList.remove("active");
      dotB.classList.add("active");
      dotA.classList.remove("active");
      sideLabel.textContent = "DETALHES • HOJE";
    }
    setInterval(()=>{ showingA ? showB() : showA(); }, ROTATE_MS);

    function getAlertFor(code){
      if ([95,96,99].includes(code)) return { show:true, label:"ALERTA • TEMPESTADE" };
      if ([65,82].includes(code)) return { show:true, label:"ALERTA • CHUVA FORTE" };
      return { show:false, label:"" };
    }

    function setAlert(code){
      const a = getAlertFor(code);
      const top = document.getElementById("alertTop");
      const topText = document.getElementById("alertTopText");
      const icon = document.getElementById("alertIcon");

      if (a.show){
        top.classList.add("show");
        icon.innerHTML = svgWarn();
        topText.textContent = a.label;
      } else {
        top.classList.remove("show");
        icon.innerHTML = "";
        topText.textContent = "ALERTA • —";
      }
    }

    // ===== Auto-scroll lento (só quando precisar) =====
    let autoScrollTimer = null;
    function startAutoScrollIfNeeded(){
      const list = document.getElementById("forecastList");
      if (!list) return;

      if (autoScrollTimer) {
        clearInterval(autoScrollTimer);
        autoScrollTimer = null;
      }

      // deixa o layout “assentar”
      setTimeout(()=>{
        const needs = list.scrollHeight > (list.clientHeight + 2);
        if (!needs) { list.scrollTop = 0; return; }

        let direction = 1;
        const speed = 0.35; // pixels por tick (lento)
        const pauseAtEndsMs = 900;

        autoScrollTimer = setInterval(()=>{
          const maxScroll = list.scrollHeight - list.clientHeight;
          if (maxScroll <= 0) { list.scrollTop = 0; return; }

          list.scrollTop += direction * speed;

          if (list.scrollTop >= maxScroll - 1){
            list.scrollTop = maxScroll;
            direction = -1;
            // pequena pausa nas “pontas”
            clearInterval(autoScrollTimer);
            autoScrollTimer = setTimeout(()=>startAutoScrollIfNeeded(), pauseAtEndsMs);
          } else if (list.scrollTop <= 1 && direction === -1){
            list.scrollTop = 0;
            direction = 1;
            clearInterval(autoScrollTimer);
            autoScrollTimer = setTimeout(()=>startAutoScrollIfNeeded(), pauseAtEndsMs);
          }
        }, 18);
      }, 250);
    }

    let dailyData = null;

    // ===== Próximos dias (sem repetir ícone no badge + temps horizontais) =====
    function renderForecastList(){
      const list = document.getElementById("forecastList");
      list.innerHTML = "";
      if(!dailyData) return;

      const { time, weather_code, temperature_2m_max, temperature_2m_min, precipitation_probability_max, precipitation_sum } = dailyData;

      const start = 1;
      const end = Math.min(time.length, 6);

      for(let i=start; i<end; i++){
        const meta = codeToMeta(weather_code[i]);
        const pop = precipitation_probability_max?.[i] ?? 0;
        const mm = (precipitation_sum?.[i] ?? 0);
        const max = Math.round(temperature_2m_max[i]);
        const min = Math.round(temperature_2m_min[i]);

        const row = document.createElement("div");
        row.className = "fRow";
        row.innerHTML = `
          <div class="fDow">${dowPT(time[i])}</div>

          <div class="fIcon" aria-hidden="true">
            ${meta.icon}
          </div>

          <div class="fMid">
            <div class="fBadge">${meta.text}</div>
            <div class="fSub">${Math.round(mm*10)/10} mm • ${pop}%</div>
          </div>

          <div class="fTemps">
            <span class="pill">${max}°</span>
            <span class="pill" style="opacity:.75">${min}°</span>
          </div>
        `;
        list.appendChild(row);
      }

      startAutoScrollIfNeeded();
    }

    function renderTodayDetails(){
      if(!dailyData) return;

      const { weather_code, temperature_2m_max, temperature_2m_min, precipitation_probability_max, precipitation_sum } = dailyData;

      const idx = 0;
      const meta = codeToMeta(weather_code[idx]);
      const pop = precipitation_probability_max?.[idx] ?? 0;
      const mm = (precipitation_sum?.[idx] ?? 0);
      const max = Math.round(temperature_2m_max[idx]);
      const min = Math.round(temperature_2m_min[idx]);

      document.getElementById("tMax").textContent = `${max}°`;
      document.getElementById("tMin").textContent = `${min}°`;

      document.getElementById("pillCond").innerHTML = `${meta.icon}<span id="condTxt">${meta.text.toUpperCase()}</span>`;
      document.getElementById("pillRain").innerHTML = `${svgRain()}<span id="rainMm">${Math.round(mm*10)/10} mm</span>`;
      document.getElementById("pillPop").innerHTML = `${svgDrop()}<span id="popPct">${pop}% chuva</span>`;
    }

    function buildAnimatedNowIcon(kind){
      if (kind === "rain"){
        return `
          <svg class="animFloat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h13z"/>
            <path class="animRainDrop" d="M8 19l-1 2"></path>
            <path class="animRainDrop" style="animation-delay:.2s" d="M12 19l-1 2"></path>
            <path class="animRainDrop" style="animation-delay:.4s" d="M16 19l-1 2"></path>
          </svg>
        `;
      }
      if (kind === "storm"){
        return `
          <svg class="animFloat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h9"/>
            <path class="animLightning" d="M13 14l-2 4h3l-2 4"></path>
          </svg>
        `;
      }
      if (kind === "sun") return `<div class="animFloat">${svgSun()}</div>`;
      if (kind === "partly") return `<div class="animFloat">${svgPartly()}</div>`;
      return `<div class="animFloat">${svgCloud()}</div>`;
    }

    async function loadWeather(){
      const url = new URL("https://api.open-meteo.com/v1/forecast");
      url.searchParams.set("latitude", CITY.lat);
      url.searchParams.set("longitude", CITY.lon);
      url.searchParams.set("timezone", TZ);
      url.searchParams.set("current", "temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m");
      url.searchParams.set("daily", "weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,precipitation_sum");
      url.searchParams.set("forecast_days", "6");

      const res = await fetch(url.toString(), { cache:"no-store" });
      if(!res.ok) throw new Error("Falha ao carregar clima");
      const data = await res.json();

      document.getElementById("cityName").textContent = CITY.name;
      document.getElementById("footUpdated").textContent = `ATUALIZADO • ${ddmm_hhmm()}`;

      const cur = data.current;
      const now = codeToMeta(cur.weather_code);

      setAlert(cur.weather_code);

      document.getElementById("tempNow").innerHTML = `${Math.round(cur.temperature_2m)}<small>°C</small>`;
      document.getElementById("descNow").textContent = now.text.toUpperCase();
      document.getElementById("nowIcon").innerHTML = buildAnimatedNowIcon(now.kind);

      document.getElementById("wind").textContent = `${Math.round(cur.wind_speed_10m)} km/h`;
      document.getElementById("humidity").textContent = `${Math.round(cur.relative_humidity_2m)}%`;
      document.getElementById("feels").textContent = `${Math.round(cur.apparent_temperature)}°`;

      dailyData = data.daily;
      renderForecastList();
      renderTodayDetails();
    }

    async function resolveCityByIP(){
      const res = await fetch("https://ipapi.co/json/", { cache:"no-store" });
      if(!res.ok) throw new Error("ipapi falhou");
      const j = await res.json();

      const lat = Number(j.latitude);
      const lon = Number(j.longitude);
      const city = (j.city || "").trim();
      const region = (j.region_code || j.region || "").trim();

      if (!Number.isFinite(lat) || !Number.isFinite(lon)) throw new Error("coords inválidas");
      const name = city ? `${city}${region ? " • " + region : ""}` : (region || "LOCAL");

      CITY = { name, lat, lon, state: region || "" };
      const sub = (CITY.state === "ES") ? "LOCAL • ES" : "LOCAL";
      document.getElementById("subtitle").textContent = sub;
    }

    showA();

    (async ()=>{
      try{
        await resolveCityByIP();
      }catch(e){
        CITY = { ...FALLBACK_CITY };
        document.getElementById("subtitle").textContent = "LOCAL • ES";
      }

      try{
        await loadWeather();
      }catch(err){
        document.getElementById("descNow").textContent = "SEM CONEXÃO";
        document.getElementById("cityName").textContent = CITY.name || "—";
        document.getElementById("footUpdated").textContent = "ATUALIZADO • —";
        console.error(err);
      }

      setInterval(()=>loadWeather().catch(()=>{}), 1000 * 60 * WEATHER_REFRESH_MIN);
    })();
  </script>
</body>
</html>
