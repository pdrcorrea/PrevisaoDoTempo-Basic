<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PontoView • Previsão do Tempo</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800;900&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg0:#081423;
      --bg1:#0a2232;

      --card:#ffffff;
      --line:#e7eef7;
      --chip:#f3f6fb;
      --muted:#6b7788;
      --ink:#0e1b2a;

      --topA:#0b2a44;
      --topB:#2c6aa3;
      --topC:#0f3d63;

      /* ====== FLUID SCALE (4K -> 720p + vertical) ====== */
      --safe: clamp(10px, 1.2vw, 34px);
      --pad:  clamp(12px, 1.15vw, 28px);
      --gap:  clamp(10px, 1.0vw, 22px);

      --radius: clamp(18px, 1.2vw, 30px);      /* bordas maiores (estilo antigo) */
      --shadow:0 12px 36px rgba(0,0,0,.28);

      --t-title: clamp(18px, 1.4vw, 36px);
      --t-sub:   clamp(11px, 0.9vw, 16px);
      --t-clock: clamp(26px, 3.0vw, 68px);

      --footerH: clamp(48px, 5.6vh, 84px);

      --panelSoft:#f6f9fe;

      --anim: 520ms;
      --ease: cubic-bezier(.2,.8,.2,1);

      /* ALERT forte */
      --warnBg:#fff0c2;
      --warnInk:#5a3a00;
      --warnLine:#f2c66a;
      --warnHot:#f59e0b;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 900px at 25% 10%, rgba(87,184,231,.22) 0%, rgba(10,46,62,0) 60%),
        radial-gradient(900px 700px at 75% 80%, rgba(52,198,208,.14) 0%, rgba(6,18,24,0) 65%),
        radial-gradient(1400px 1100px at 50% 55%, var(--bg1) 0%, var(--bg0) 62%, #040a0f 100%);
      overflow:hidden;
    }

    /* ====== FRAME / CARD ====== */
    .pvFrame{
      width:100vw;
      height:100vh;
      padding: var(--safe);
      display:flex;
    }

    .pvCard{
      width:100%;
      height:100%;
      background:var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
      opacity:0;
      transform: translateY(12px);
      animation: pvIn 900ms cubic-bezier(.22,1,.36,1) forwards;

      /* container queries (ajuda no vertical/pequeno) */
      container-type: inline-size;
      container-name: pvpanel;
    }
    @keyframes pvIn{to{opacity:1; transform:translateY(0)}}

    /* ===== HEADER ===== */
    .pvHeader{
      position:relative;
      background: linear-gradient(180deg, var(--topB) 0%, var(--topC) 42%, var(--topA) 100%);
      color:#fff;
      padding: calc(var(--pad) * 1.05);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:var(--gap);
      flex:0 0 auto;
      min-width:0;
      border-bottom: 1px solid rgba(255,255,255,.12);
      box-shadow: inset 0 -1px 0 rgba(255,255,255,.18);
    }
    .pvHeader::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 120px at 50% 0%, rgba(255,255,255,.22), rgba(255,255,255,0) 65%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,0) 42%);
      opacity:.95;
    }
    .pvHeader::after{
      content:"";
      position:absolute;
      inset:10px;
      border-radius: calc(var(--radius) - 10px);
      border: 1px solid rgba(255,255,255,.10);
      pointer-events:none;
      opacity:.45;
    }

    .pvLeft, .pvRight{position:relative; z-index:1;}
    .pvLeft{
      display:flex;
      align-items:center;
      gap:var(--gap);
      min-width:0;
      flex:1 1 auto;
    }
    .pvBadge{
      width:clamp(46px,3.4vw,68px);
      height:clamp(46px,3.4vw,68px);
      border-radius: 18px; /* maior */
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.22);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.18);
      display:grid;
      place-items:center;
      flex:0 0 auto;
    }
    .pvBadge svg{width:60%; height:60%; opacity:.95}

    .pvTitles{
      display:flex;
      flex-direction:column;
      gap:6px;
      line-height:1.05;
      min-width:0;
    }
    .pvTitle{
      margin:0;
      font-size:var(--t-title);
      font-weight:900;
      letter-spacing:.06em;
      text-transform:uppercase;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .pvSubtitle{
      font-size:var(--t-sub);
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      opacity:.92;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .pvRight{
      text-align:right;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:max-content;
      align-items:flex-end;
      padding-left: 10px;
      white-space:nowrap;
    }
    .pvClock{
      font-size:var(--t-clock);
      font-weight:900;
      line-height:1;
      letter-spacing:.02em;
      font-variant-numeric: tabular-nums;
    }

    /* ===== SUBBAR ===== */
    .pvSubbar{
      background:var(--chip);
      border-bottom:1px solid var(--line);
      padding:calc(var(--pad)*.62) var(--pad);
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      gap:var(--gap);
      font-size:var(--t-sub);
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:#1c2c41;
      flex:0 0 auto;
      min-width:0;
    }
    .pvSubLeft{
      justify-self:start;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .pvSubRight{
      justify-self:end;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:12px;
      min-width:0;
      white-space:nowrap;
    }
    .sourceTag{
      font-size: clamp(10px, 0.8vw, 12px);
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#3b4b62;
      opacity:.95;
      white-space:nowrap;
      padding:clamp(6px,.7vw,8px) clamp(10px,1.0vw,12px);
      border-radius:999px;
      background:#fff;
      border:1px solid #e7e9ee;
      box-shadow: 0 8px 18px rgba(0,0,0,.04);
    }

    /* ALERT */
    .alertPill{
      display:none;
      align-items:center;
      gap:10px;
      padding:clamp(7px,.8vw,10px) clamp(10px,1.0vw,14px);
      border-radius:999px;
      background: var(--warnBg);
      border:2px solid var(--warnLine);
      color: var(--warnInk);
      font-size: clamp(10px, 0.85vw, 12px);
      font-weight: 900;
      letter-spacing:.10em;
      text-transform:uppercase;
      white-space:nowrap;
      box-shadow:
        0 10px 24px rgba(245,158,11,.18),
        0 0 0 0 rgba(245,158,11,.35);
      animation: alertGlow 1.2s var(--ease) infinite;
    }
    .alertPill.show{display:inline-flex;}
    .alertPill svg{width:18px; height:18px; flex:0 0 auto;}
    .alertPulse{
      width:10px; height:10px; border-radius:999px;
      background:var(--warnHot);
      box-shadow: 0 0 0 0 rgba(245,158,11,.45);
      animation: alertPulse 1.2s var(--ease) infinite;
    }
    @keyframes alertPulse{
      0%{box-shadow:0 0 0 0 rgba(245,158,11,.45)}
      70%{box-shadow:0 0 0 14px rgba(245,158,11,0)}
      100%{box-shadow:0 0 0 0 rgba(245,158,11,0)}
    }
    @keyframes alertGlow{
      0%,100%{box-shadow: 0 10px 24px rgba(245,158,11,.18), 0 0 0 0 rgba(245,158,11,.25)}
      50%{box-shadow: 0 14px 30px rgba(245,158,11,.26), 0 0 0 6px rgba(245,158,11,.08)}
    }

    /* ===== MAIN ===== */
    .pvMain{
      flex:1 1 auto;
      min-height:0;
      padding:var(--pad);
      display:flex;
      overflow:hidden;
    }
    .layout{
      width:100%;
      display:grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: var(--gap);
      align-items: stretch;
      min-height:0;
    }

    /* ====== FLUID: muda para 1 coluna automaticamente no vertical / estreito ====== */
    @media (max-aspect-ratio: 4/3){
      .layout{grid-template-columns:1fr;}
    }
    /* container query: se o painel ficar estreito, também cai pra 1 coluna */
    @container pvpanel (max-width: 760px){
      .layout{grid-template-columns:1fr;}
    }

    /* ===== HOJE (ESQUERDA) ===== */
    .todayCard{
      border:1px solid var(--line);
      border-radius: 24px; /* maior */
      background:#fff;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .todayHead{
      padding: clamp(14px, 1.0vw, 18px) clamp(14px, 1.0vw, 18px) clamp(8px, .7vw, 10px);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      min-width:0;
      flex:0 0 auto;
    }
    .city{
      font-size: clamp(14px, 1.15vw, 18px);
      font-weight: 900;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#1a2a40;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .todayCenter{
      padding: clamp(6px,.8vw,8px) clamp(14px, 1.0vw, 18px) 0;
      flex:1 1 auto;
      min-height:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .todayWrap{
      width:100%;
      max-width: min(780px, 92%);
      display:grid;
      grid-template-columns: clamp(80px, 8vw, 155px) 1fr;
      align-items:center;
      gap: clamp(12px, 1.4vw, 22px);
    }
    .todayIcon{
      width: clamp(80px, 8vw, 155px);
      height: clamp(80px, 8vw, 155px);
      display:grid;
      place-items:center;
      color:#0f3d63;
      opacity:.95;
    }
    .todayIcon svg{width:100%; height:100%}

    .tempBlock{min-width:0}
    .tempBig{
      font-size: clamp(52px, 6.6vw, 160px);
      font-weight: 900;
      letter-spacing:-0.03em;
      line-height: .92;
      white-space:nowrap;
    }
    .tempBig small{font-size:.42em; font-weight: 900; opacity:.92}
    .condLine{
      margin-top: clamp(6px,.8vw,10px);
      font-size: clamp(11px, 1.0vw, 14px);
      font-weight: 900;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:#2a3a50;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .todayBottom{
      padding: clamp(10px, 1.0vw, 14px) clamp(14px, 1.0vw, 18px) clamp(12px, 1.1vw, 16px);
      border-top:1px solid var(--line);
      background:#fff;
      flex:0 0 auto;
    }

    .metricsRow{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: clamp(8px, .9vw, 12px);
      align-items:stretch;
    }
    /* Em telas mais estreitas, vira 2 colunas, depois 1 */
    @container pvpanel (max-width: 980px){
      .metricsRow{ grid-template-columns: repeat(2, 1fr); }
    }
    @container pvpanel (max-width: 560px){
      .metricsRow{ grid-template-columns: 1fr; }
    }

    .mCard{
      background:#f1f3f5;
      border:1px solid #eceff3;
      border-radius: 16px; /* maior */
      padding: clamp(9px, .9vw, 12px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      min-width:0;
    }
    .mLeft{display:flex; align-items:center; gap:10px; min-width:0;}
    .mIcon{
      width:clamp(28px, 2.4vw, 34px);
      height:clamp(28px, 2.4vw, 34px);
      border-radius: 13px;
      background:#fff;
      border:1px solid #e7e9ee;
      display:grid; place-items:center;
      color:#1a2a40;
      opacity:.9;
      flex:0 0 auto;
    }
    .mIcon svg{width:62%; height:62%}
    .mLabel{
      font-size: clamp(9px, .8vw, 11px);
      font-weight: 900;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:#3b4b62;
      white-space:nowrap;
    }
    .mVal{
      font-size: clamp(14px, 1.35vw, 18px);
      font-weight: 900;
      white-space:nowrap;
      color:#0e1b2a;
    }

    /* ===== DIREITA ===== */
    .side{
      border:1px solid var(--line);
      border-radius: 24px; /* maior */
      background:#fff;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .sideHeader{
      padding: clamp(10px, .9vw, 14px) clamp(12px, 1.0vw, 16px);
      background: var(--panelSoft);
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex:0 0 auto;
    }
    .sideHeader .label{
      font-size: clamp(10px, .9vw, 12px);
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color:#3b4b62;
      white-space:nowrap;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toggleDots{display:flex; gap:8px; align-items:center;}
    .tdot{width:10px; height:10px; border-radius:999px; background:#c9d7ea; transition: all 420ms var(--ease);}
    .tdot.active{background:#2d76b9; width:22px;}

    .slot{
      position:relative;
      flex:1 1 auto;
      padding: clamp(12px, 1.0vw, 16px);
      min-height:0;
      background:#fff;
      overflow:hidden;
    }

    .view{
      position:absolute;
      inset: clamp(12px, 1.0vw, 16px);
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition: opacity var(--anim) var(--ease), transform var(--anim) var(--ease);
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height:0;
    }
    .view.active{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    /* Próximos dias */
    .forecastList{
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height:0;
      overflow:auto;
      overscroll-behavior: contain;
      scrollbar-width: none;
    }
    .forecastList::-webkit-scrollbar{ width:0; height:0; }

    .fRow{
      background:#f1f3f5;
      border:1px solid #eceff3;
      border-radius: 16px; /* maior */
      padding: clamp(9px, .9vw, 12px);
      display:grid;
      grid-template-columns: 56px 44px 1fr auto;
      align-items:center;
      gap: clamp(8px, .9vw, 12px);
      min-width:0;
    }
    .fDow{
      font-size: clamp(11px, 1.0vw, 14px);
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color:#1a2a40;
      white-space:nowrap;
    }
    .fIcon{
      width:clamp(38px, 3.2vw, 44px);
      height:clamp(38px, 3.2vw, 44px);
      border-radius: 16px;
      background:#fff;
      border:1px solid #e7e9ee;
      display:grid;
      place-items:center;
      color:#0f3d63;
      opacity:.95;
      flex:0 0 auto;
    }
    .fIcon svg{width:70%; height:70%}
    .fMid{min-width:0; display:flex; flex-direction:column; gap:6px;}
    .fBadge{
      display:inline-flex;
      align-items:center;
      padding: clamp(6px, .7vw, 8px) clamp(10px, 1.0vw, 12px);
      border-radius:999px;
      background:#fff;
      border:1px solid #e7e9ee;
      width: fit-content;
      max-width: 100%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size: clamp(10px, .9vw, 12px);
      font-weight: 900;
      letter-spacing:.08em;
      text-transform: uppercase;
      color:#23344a;
    }
    .fSub{
      font-size: clamp(9px, .85vw, 11px);
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#3b4b62;
      opacity:.92;
      white-space:nowrap;
    }
    .fTemps{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      white-space:nowrap;
      font-weight: 900;
    }
    .pill{
      position: relative;
      padding: clamp(8px, .85vw, 10px) clamp(10px, 1.0vw, 12px) clamp(6px, .7vw, 8px);
      min-width: clamp(48px, 4.0vw, 56px);
      border-radius: 999px;
      background:#fff;
      border:1px solid #e7e9ee;
      font-size: clamp(10px, .9vw, 12px);
      font-weight: 900;
      color:#0e1b2a;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .pillTag{
      position:absolute;
      top:5px;
      left:50%;
      transform:translateX(-50%);
      font-size: 9px;
      font-weight: 900;
      letter-spacing: .14em;
      text-transform: uppercase;
      opacity: .55;
      line-height: 1;
      pointer-events:none;
    }
    .pillTemp{
      display:block;
      margin-top: 10px;
      font-size: clamp(10px, .95vw, 12px);
      font-weight: 900;
    }

    /* Detalhes de HOJE (view B) */
    .detailCard{
      border:1px solid #eef2f7;
      border-radius: 18px;
      padding: clamp(10px, 1.0vw, 14px);
      background:#fff;
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height:0;
    }
    .bigMinMax{
      display:flex;
      gap: 18px;
      align-items:flex-end;
      justify-content:flex-start;
      padding: 6px 2px 4px;
      flex-wrap:wrap;
    }
    .mmBlock{display:flex; align-items:baseline; gap:10px;}
    .mmNum{
      font-size: clamp(36px, 3.6vw, 72px);
      font-weight: 900;
      letter-spacing:-0.02em;
      line-height:1;
      color:#0e1b2a;
      white-space:nowrap;
    }
    .mmLbl{
      font-size: clamp(10px, .9vw, 12px);
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#7a8697;
      white-space:nowrap;
    }
    .detailPills{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .dPill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: clamp(8px, .85vw, 10px) clamp(10px, 1.0vw, 12px);
      border-radius:999px;
      background:#fff;
      border:1px solid #e7e9ee;
      box-shadow: 0 8px 18px rgba(0,0,0,.04);
      font-size: clamp(10px, .9vw, 12px);
      font-weight: 900;
      letter-spacing:.08em;
      text-transform: uppercase;
      color:#23344a;
      white-space:nowrap;
    }
    .dPill svg{width:16px;height:16px;opacity:.9}

    /* ===== FOOTER ===== */
    .pvFooter{
      flex:0 0 auto;
      height: var(--footerH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px var(--pad);
      border-top:1px solid var(--line);
      background: transparent;
      gap: 12px;
      min-width:0;
    }
    .pvFooterUpdate{
      font-size: clamp(10px, .85vw, 11px);
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color:#3b4b62;
      opacity:.95;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .pvLogo{
      height: clamp(16px, 2.4vh, 22px);
      width:auto;
      display:block;
      opacity:.90;
    }

    /* ===== ÍCONE HOJE animado ===== */
    .animFloat{
      animation: floaty 2.8s var(--ease) infinite;
      transform-origin: 50% 50%;
    }
    @keyframes floaty{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-6px)}
    }
    .animRainDrop{animation: drop 1.2s linear infinite;}
    @keyframes drop{
      0%{transform: translateY(-2px); opacity:.2}
      35%{opacity:1}
      100%{transform: translateY(10px); opacity:0}
    }
    .animLightning{
      animation: flash 1.1s var(--ease) infinite;
      transform-origin: 50% 50%;
    }
    @keyframes flash{
      0%,60%,100%{opacity:1; transform: scale(1)}
      30%{opacity:.2; transform: scale(.98)}
    }

    /* ===== Sensação térmica: estilo “card” com cor e pulso (apenas icFeel) ===== */
    #icFeel{ position:relative; overflow:hidden; }
    #icFeel svg{ transition: transform 280ms var(--ease); }

    /* normal: igual aos demais */
    #icFeel.feel-ok{ color:#1a2a40; }

    /* quente/frio: muda cor do ícone e pulse no fundo do badge do ícone */
    #icFeel.feel-hot,
    #icFeel.feel-hot-extreme{
      color:#ef4444;
    }
    #icFeel.feel-cold,
    #icFeel.feel-cold-extreme{
      color:#3b82f6;
    }

    /* “pulso” só quando extremo */
    #icFeel.feel-hot-extreme::after,
    #icFeel.feel-cold-extreme::after{
      content:"";
      position:absolute;
      inset:-30%;
      border-radius:999px;
      pointer-events:none;
      opacity:0;
      animation: pvFeelPulse 1.15s var(--ease) infinite;
    }
    #icFeel.feel-hot-extreme::after{
      background: radial-gradient(circle at 45% 45%, rgba(239,68,68,.45) 0%, rgba(239,68,68,0) 60%);
    }
    #icFeel.feel-cold-extreme::after{
      background: radial-gradient(circle at 45% 45%, rgba(59,130,246,.38) 0%, rgba(59,130,246,0) 60%);
    }
    @keyframes pvFeelPulse{
      0%{ opacity:.0; transform: scale(.92); }
      35%{ opacity:.9; transform: scale(1.05); }
      75%{ opacity:.15; transform: scale(1.12); }
      100%{ opacity:0; transform: scale(1.08); }
    }

    /* ====== HARD GUARDBANDS (4K -> 720p) ======
       garante que em 720p o painel não “explode” */
    @media (max-height: 720px){
      :root{
        --safe: 12px;
        --pad:  14px;
        --gap:  12px;
        --t-clock: clamp(24px, 2.6vw, 46px);
        --footerH: 58px;
      }
      .pvFooter{ padding: 8px var(--pad); }
    }
    /* Vertical / portrait (ex: 1080x1920, 720x1280): prioriza legibilidade */
    @media (orientation: portrait){
      :root{
        --safe: clamp(10px, 1.6vw, 22px);
        --pad:  clamp(12px, 1.6vw, 22px);
        --gap:  clamp(10px, 1.2vw, 18px);
        --footerH: clamp(52px, 5.0vh, 72px);
      }
      .pvSubbar{ grid-template-columns: 1fr; }
      .pvSubRight{ justify-self:start; flex-wrap:wrap; }
    }
  </style>
</head>

<body>
  <div class="pvFrame">
    <div class="pvCard" id="panel" data-title="PREVISÃO DO TEMPO" data-subtitle="LOCAL • ES">
      <header class="pvHeader">
        <div class="pvLeft">
          <div class="pvBadge" aria-hidden="true" id="hdrIcon"></div>
          <div class="pvTitles">
            <h1 class="pvTitle" id="title"></h1>
            <div class="pvSubtitle" id="subtitle"></div>
          </div>
        </div>
        <div class="pvRight">
          <div class="pvClock" id="pvClock">--:--</div>
        </div>
      </header>

      <div class="pvSubbar">
        <div class="pvSubLeft" id="subLeft">HOJE • PRÓXIMOS DIAS</div>
        <div class="pvSubRight">
          <div class="sourceTag" id="subSource">FONTE • OPEN-METEO</div>

          <div class="alertPill" id="alertTop">
            <span class="alertPulse" aria-hidden="true"></span>
            <span id="alertIcon" aria-hidden="true"></span>
            <span id="alertTopText">ALERTA • —</span>
          </div>
        </div>
      </div>

      <main class="pvMain">
        <div class="layout">
          <!-- ESQUERDA: HOJE -->
          <section class="todayCard">
            <div class="todayHead">
              <div class="city" id="cityName">—</div>
            </div>

            <div class="todayCenter">
              <div class="todayWrap">
                <div class="todayIcon" id="todayIcon" aria-hidden="true"></div>
                <div class="tempBlock">
                  <div class="tempBig" id="tempToday">--<small>°C</small></div>
                  <div class="condLine" id="descToday">CARREGANDO…</div>
                </div>
              </div>
            </div>

            <div class="todayBottom">
              <div class="metricsRow">
                <div class="mCard">
                  <div class="mLeft">
                    <div class="mIcon" aria-hidden="true" id="icFeel"></div>
                    <div class="mLabel">SENSAÇÃO</div>
                  </div>
                  <div class="mVal" id="feels">--°</div>
                </div>

                <div class="mCard">
                  <div class="mLeft">
                    <div class="mIcon" aria-hidden="true" id="icWind"></div>
                    <div class="mLabel">VENTO</div>
                  </div>
                  <div class="mVal" id="wind">-- km/h</div>
                </div>

                <div class="mCard">
                  <div class="mLeft">
                    <div class="mIcon" aria-hidden="true" id="icHum"></div>
                    <div class="mLabel">UMIDADE</div>
                  </div>
                  <div class="mVal" id="humidity">--%</div>
                </div>
              </div>
            </div>
          </section>

          <!-- DIREITA: Alterna -->
          <aside class="side">
            <div class="sideHeader">
              <div class="label" id="sideLabel">PRÓXIMOS DIAS</div>
              <div class="toggleDots" aria-hidden="true">
                <div class="tdot active" id="dotA"></div>
                <div class="tdot" id="dotB"></div>
              </div>
            </div>

            <div class="slot">
              <!-- View A: Próximos dias -->
              <div class="view active" id="viewA">
                <div class="forecastList" id="forecastList"></div>
              </div>

              <!-- View B: Detalhes hoje -->
              <div class="view" id="viewB">
                <div class="detailCard">
                  <div class="bigMinMax">
                    <div class="mmBlock">
                      <div class="mmNum" id="tMax">--°</div>
                      <div class="mmLbl">máx</div>
                    </div>
                    <div class="mmBlock">
                      <div class="mmNum" id="tMin">--°</div>
                      <div class="mmLbl">mín</div>
                    </div>
                  </div>

                  <div class="detailPills">
                    <div class="dPill" id="pillRain"><span id="rainMm">-- mm</span></div>
                    <div class="dPill" id="pillPop"><span id="popPct">--% chuva</span></div>
                    <div class="dPill" id="pillCond"><span id="condTxt">—</span></div>
                  </div>
                </div>
              </div>
            </div>
          </aside>

        </div>
      </main>

      <footer class="pvFooter" aria-label="Rodapé PontoView">
        <div class="pvFooterUpdate" id="footUpdated">ATUALIZADO • —</div>
        <img class="pvLogo" src="./assets/logo-pontoview.png" alt="Logo PontoView" />
      </footer>
    </div>
  </div>

  <script>
    const FALLBACK_CITY = { name: "Vitória - ES", lat: -20.3155, lon: -40.3128, state: "ES" };
    const ROTATE_MS = 11000;          // alterna a view da direita
    const WEATHER_REFRESH_MIN = 25;
    const TZ = "America/Sao_Paulo";

    // sensação térmica: limites
    const FEEL_COLD = 19;        // <= 19°C
    const FEEL_HOT = 30;         // >= 30°C
    const FEEL_EXTREME_COLD = 12;
    const FEEL_EXTREME_HOT = 35;

    let CITY = { ...FALLBACK_CITY };
    let dailyData = null;

    function pad2(n){ return String(n).padStart(2,"0"); }
    function hhmm(d=new Date()){ return pad2(d.getHours())+":"+pad2(d.getMinutes()); }
    function ddmm_hhmm(d=new Date()){
      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      return `${dd}/${mm}, ${hhmm(d)}`;
    }

    const panel = document.getElementById("panel");
    document.getElementById("title").textContent = panel.dataset.title || "PREVISÃO DO TEMPO";
    document.getElementById("subtitle").textContent = panel.dataset.subtitle || "LOCAL • ES";

    function tickClock(){ document.getElementById("pvClock").textContent = hhmm(); }
    tickClock();
    setInterval(tickClock, 1000);

    /* ===== SVGs ===== */
    function svgCloud(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 17.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 10.2 3.8 3.8 0 0 0 7 17.5h13z"/>
      </svg>`; }
    function svgSun(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="4"></circle>
        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path>
      </svg>`; }
    function svgMoon(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 14.5A8.5 8.5 0 0 1 9.5 3a6.8 6.8 0 1 0 11.5 11.5z"></path>
      </svg>`; }
    function svgRain(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h13z"/>
        <path d="M8 19l-1 2"></path>
        <path d="M12 19l-1 2"></path>
        <path d="M16 19l-1 2"></path>
      </svg>`; }
    function svgStorm(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h9"/>
        <path d="M13 14l-2 4h3l-2 4"></path>
      </svg>`; }
    function svgPartly(isNight=false){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        ${isNight
          ? `<path d="M15.5 3.2A5.6 5.6 0 0 0 13 14.3a5.6 5.6 0 0 1 2.5-11.1z"></path>`
          : `<circle cx="8" cy="8" r="3"></circle>
             <path d="M8 2v1M8 13v1M2 8h1M13 8h1M3.5 3.5l.7.7M11.8 11.8l.7.7M3.5 12.5l.7-.7M11.8 4.2l.7-.7"></path>`
        }
        <path d="M20 17.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 8.3 10.1 3.8 3.8 0 0 0 9 17.5h11z"/>
      </svg>`; }
    function svgWind(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 12h11"/>
        <path d="M14 12a3 3 0 1 0-3-3"/>
        <path d="M3 18h15"/>
        <path d="M18 18a3 3 0 1 0-3-3"/>
      </svg>`; }
    function svgDrop(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 2s6 7 6 12a6 6 0 0 1-12 0c0-5 6-12 6-12z"/>
      </svg>`; }
    function svgThermo(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 14.76V5a2 2 0 0 0-4 0v9.76a4 4 0 1 0 4 0z"/>
      </svg>`; }
    function svgWarn(){ return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10.3 3.2 1.8 18a2 2 0 0 0 1.7 3h17a2 2 0 0 0 1.7-3L13.7 3.2a2 2 0 0 0-3.4 0z"/>
        <path d="M12 9v4"/>
        <path d="M12 17h.01"/>
      </svg>`; }

    document.getElementById("hdrIcon").innerHTML = svgCloud();
    document.getElementById("icFeel").innerHTML = svgThermo();
    document.getElementById("icWind").innerHTML = svgWind();
    document.getElementById("icHum").innerHTML = svgDrop();

    /* ===== Dia/noite (sem geolocalização do device) =====
       Painéis (Adeus Pendrive) não pedem permissão.
       Usa hora local do painel: 06:00–18:00 = dia */
    function isNightNow(){
      const h = new Date().getHours();
      return (h < 6 || h >= 18);
    }

    function codeToMeta(code){
      const night = isNightNow();
      if (code === 0) return { icon: night ? svgMoon() : svgSun(), text: night ? "Céu limpo" : "Ensolarado", kind: night ? "moon" : "sun" };
      if (code === 1 || code === 2) return { icon: svgPartly(night), text: "Parcialmente nublado", kind:"partly" };
      if (code === 3) return { icon: svgCloud(), text: "Nublado", kind:"cloud" };
      if ([45,48].includes(code)) return { icon: svgCloud(), text: "Neblina", kind:"cloud" };
      if ([51,53,55,61,63,65,80,81,82].includes(code)) return { icon: svgRain(), text: "Chuva", kind:"rain" };
      if ([95,96,99].includes(code)) return { icon: svgStorm(), text: "Tempestade", kind:"storm" };
      return { icon: svgCloud(), text: "Tempo", kind:"cloud" };
    }

    function buildAnimatedTodayIcon(kind){
      if (kind === "rain"){
        return `
          <svg class="animFloat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h13z"/>
            <path class="animRainDrop" d="M8 19l-1 2"></path>
            <path class="animRainDrop" style="animation-delay:.2s" d="M12 19l-1 2"></path>
            <path class="animRainDrop" style="animation-delay:.4s" d="M16 19l-1 2"></path>
          </svg>
        `;
      }
      if (kind === "storm"){
        return `
          <svg class="animFloat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 16.5a4.5 4.5 0 0 0-1.3-8.8A6 6 0 0 0 6.2 9.2 3.8 3.8 0 0 0 7 16.5h9"/>
            <path class="animLightning" d="M13 14l-2 4h3l-2 4"></path>
          </svg>
        `;
      }
      if (kind === "sun") return `<div class="animFloat">${svgSun()}</div>`;
      if (kind === "moon") return `<div class="animFloat">${svgMoon()}</div>`;
      if (kind === "partly") return `<div class="animFloat">${svgPartly(isNightNow())}</div>`;
      return `<div class="animFloat">${svgCloud()}</div>`;
    }

    function dowPT(dateStr){
      const d = new Date(dateStr + "T12:00:00");
      const map = ["DOM","SEG","TER","QUA","QUI","SEX","SÁB"];
      return map[d.getDay()];
    }

    /* ===== ALERTA ===== */
    function getAlertFor(code){
      if ([95,96,99].includes(code)) return { show:true, label:"ALERTA • TEMPESTADE" };
      if ([65,82].includes(code)) return { show:true, label:"ALERTA • CHUVA FORTE" };
      return { show:false, label:"" };
    }
    function setAlert(code){
      const a = getAlertFor(code);
      const top = document.getElementById("alertTop");
      const topText = document.getElementById("alertTopText");
      const icon = document.getElementById("alertIcon");

      if (a.show){
        top.classList.add("show");
        icon.innerHTML = svgWarn();
        topText.textContent = a.label;
      } else {
        top.classList.remove("show");
        icon.innerHTML = "";
        topText.textContent = "ALERTA • —";
      }
    }

    /* ===== AUTO-SCROLL (loop) ===== */
    /* ===== AUTO-SCROLL (loop) — substitua a função inteira por esta ===== */
let autoScrollRAF = null;
let autoScrollPausedUntil = 0;

function stopAutoScroll(){
  if (autoScrollRAF) cancelAnimationFrame(autoScrollRAF);
  autoScrollRAF = null;
  autoScrollPausedUntil = 0;
}

/* ===== AUTO-SCROLL (ping-pong suave + pausa topo/fim) ===== */
let autoScrollRAF = null;

function stopAutoScroll(){
  if (autoScrollRAF) cancelAnimationFrame(autoScrollRAF);
  autoScrollRAF = null;
}

function easeInOutCubic(t){
  return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2, 3)/2;
}

function animateScroll(el, to, durationMs){
  return new Promise(resolve=>{
    const start = el.scrollTop;
    const delta = to - start;
    const t0 = performance.now();

    function step(ts){
      const p = Math.min(1, (ts - t0) / durationMs);
      el.scrollTop = start + delta * easeInOutCubic(p);
      if (p < 1) autoScrollRAF = requestAnimationFrame(step);
      else resolve();
    }
    autoScrollRAF = requestAnimationFrame(step);
  });
}

async function startAutoScrollIfNeeded(){
  const list = document.getElementById("forecastList");
  if (!list) return;

  stopAutoScroll();

  // espera renderização do conteúdo
  setTimeout(async ()=>{
    const maxScroll = list.scrollHeight - list.clientHeight;
    if (maxScroll <= 2){
      list.scrollTop = 0;
      return;
    }

    // ===== Ajuste aqui =====
    const downMs = 9000;     // tempo para descer até o fim
    const upMs   = 7000;     // tempo para subir ao topo
    const pauseTopMs = 700;  // pausa no topo
    const pauseEndMs = 900;  // pausa no fim

    // loop infinito (ping-pong)
    while (true){
      // TOP pause
      await new Promise(r => setTimeout(r, pauseTopMs));

      // desce suave até o fim
      await animateScroll(list, maxScroll, downMs);

      // END pause
      await new Promise(r => setTimeout(r, pauseEndMs));

      // sobe suave até o topo
      await animateScroll(list, 0, upMs);
    }
  }, 250);
}

    // parâmetros
    const speedPxPerSec = 18;   // velocidade de rolagem (ajuste se quiser)
    const pauseMs = 900;        // pausa no final (ajuste se quiser)

    let lastTs = performance.now();

    function loop(ts){
      // pausa controlada
      if (autoScrollPausedUntil && ts < autoScrollPausedUntil){
        autoScrollRAF = requestAnimationFrame(loop);
        return;
      } else {
        autoScrollPausedUntil = 0;
      }

      const dt = (ts - lastTs) / 1000;
      lastTs = ts;

      // avança
      const step = speedPxPerSec * dt;
      list.scrollTop += step;

      // chegou no final -> pausa -> volta pro topo -> continua
      const end = list.scrollHeight - list.clientHeight;
      if (list.scrollTop >= end - 1){
        list.scrollTop = end;
        autoScrollPausedUntil = ts + pauseMs;
        // volta pro topo depois da pausa
        setTimeout(()=>{
          list.scrollTop = 0;
          lastTs = performance.now();
        }, pauseMs);
      }

      autoScrollRAF = requestAnimationFrame(loop);
    }

    autoScrollRAF = requestAnimationFrame(loop);
  }, 250);
}


    /* ===== Alternância de views (direita) ===== */
    const viewA = document.getElementById("viewA");
    const viewB = document.getElementById("viewB");
    const dotA = document.getElementById("dotA");
    const dotB = document.getElementById("dotB");
    const sideLabel = document.getElementById("sideLabel");

    let showingA = true;

    function showA(){
      showingA = true;
      viewA.classList.add("active");
      viewB.classList.remove("active");
      dotA.classList.add("active");
      dotB.classList.remove("active");
      sideLabel.textContent = "PRÓXIMOS DIAS";
      startAutoScrollIfNeeded();
    }
    function showB(){
      showingA = false;
      stopAutoScroll(); // <-- adicione isso
      viewB.classList.add("active");
      viewA.classList.remove("active");
      dotB.classList.add("active");
      dotA.classList.remove("active");
      sideLabel.textContent = "DETALHES • HOJE";
    }
    setInterval(()=>{ showingA ? showB() : showA(); }, ROTATE_MS);

    /* ===== SENS. TÉRMICA: aplica classes no #icFeel ===== */
    function applyFeelsAnimation(apparent){
      const el = document.getElementById("icFeel");
      if (!el) return;

      el.classList.remove("feel-ok","feel-hot","feel-cold","feel-hot-extreme","feel-cold-extreme");

      if (apparent >= FEEL_EXTREME_HOT) { el.classList.add("feel-hot-extreme"); return; }
      if (apparent <= FEEL_EXTREME_COLD) { el.classList.add("feel-cold-extreme"); return; }
      if (apparent >= FEEL_HOT) { el.classList.add("feel-hot"); return; }
      if (apparent <= FEEL_COLD) { el.classList.add("feel-cold"); return; }

      el.classList.add("feel-ok");
    }

    /* ===== RENDER ===== */
    function renderForecastList(){
      const list = document.getElementById("forecastList");
      list.innerHTML = "";
      if(!dailyData) return;

      const { time, weather_code, temperature_2m_max, temperature_2m_min, precipitation_probability_max, precipitation_sum } = dailyData;

      const start = 1;
      const end = Math.min(time.length, 6);

      for(let i=start; i<end; i++){
        const meta = codeToMeta(weather_code[i]);
        const pop = precipitation_probability_max?.[i] ?? 0;
        const mm = (precipitation_sum?.[i] ?? 0);
        const max = Math.round(temperature_2m_max[i]);
        const min = Math.round(temperature_2m_min[i]);

        const row = document.createElement("div");
        row.className = "fRow";
        row.innerHTML = `
          <div class="fDow">${dowPT(time[i])}</div>
          <div class="fIcon" aria-hidden="true">${meta.icon}</div>
          <div class="fMid">
            <div class="fBadge">${meta.text}</div>
            <div class="fSub">${Math.round(mm*10)/10} mm • ${pop}%</div>
          </div>
          <div class="fTemps">
            <span class="pill">
              <span class="pillTag">MÁX</span>
              <span class="pillTemp">${max}°</span>
            </span>
            <span class="pill" style="opacity:.75">
              <span class="pillTag">MÍN</span>
              <span class="pillTemp">${min}°</span>
            </span>
          </div>
        `;
        list.appendChild(row);
      }

      if (showingA) startAutoScrollIfNeeded();
    }

    function renderTodayDetails(){
      if(!dailyData) return;

      const { weather_code, temperature_2m_max, temperature_2m_min, precipitation_probability_max, precipitation_sum } = dailyData;

      const idx = 0;
      const meta = codeToMeta(weather_code[idx]);
      const pop = precipitation_probability_max?.[idx] ?? 0;
      const mm = (precipitation_sum?.[idx] ?? 0);
      const max = Math.round(temperature_2m_max[idx]);
      const min = Math.round(temperature_2m_min[idx]);

      document.getElementById("tMax").textContent = `${max}°`;
      document.getElementById("tMin").textContent = `${min}°`;

      document.getElementById("pillCond").innerHTML = `${meta.icon}<span id="condTxt">${meta.text.toUpperCase()}</span>`;
      document.getElementById("pillRain").innerHTML = `${svgRain()}<span id="rainMm">${Math.round(mm*10)/10} mm</span>`;
      document.getElementById("pillPop").innerHTML = `${svgDrop()}<span id="popPct">${Math.round(pop)}% chuva</span>`;
    }

    async function loadWeather(){
      const url = new URL("https://api.open-meteo.com/v1/forecast");
      url.searchParams.set("latitude", CITY.lat);
      url.searchParams.set("longitude", CITY.lon);
      url.searchParams.set("timezone", TZ);
      url.searchParams.set("current", "temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m");
      url.searchParams.set("daily", "weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,precipitation_sum");
      url.searchParams.set("forecast_days", "6");

      const res = await fetch(url.toString(), { cache:"no-store" });
      if(!res.ok) throw new Error("Falha ao carregar clima");
      const data = await res.json();

      document.getElementById("cityName").textContent = CITY.name;
      document.getElementById("footUpdated").textContent = `ATUALIZADO • ${ddmm_hhmm()}`;

      const cur = data.current;
      const meta = codeToMeta(cur.weather_code);

      setAlert(cur.weather_code);

      document.getElementById("tempToday").innerHTML = `${Math.round(cur.temperature_2m)}<small>°C</small>`;
      document.getElementById("descToday").textContent = meta.text.toUpperCase();
      document.getElementById("todayIcon").innerHTML = buildAnimatedTodayIcon(meta.kind);

      const feel = Math.round(cur.apparent_temperature);
      document.getElementById("feels").textContent = `${feel}°`;
      document.getElementById("wind").textContent = `${Math.round(cur.wind_speed_10m)} km/h`;
      document.getElementById("humidity").textContent = `${Math.round(cur.relative_humidity_2m)}%`;

      applyFeelsAnimation(feel);

      dailyData = data.daily;
      renderForecastList();
      renderTodayDetails();
    }

    /* ===== Localização sem permissão:
       usa serviço IP (bom pra painéis) e fallback estável ===== */
/* ===== Localização robusta (2 provedores + cache) ===== */
const CITY_CACHE_KEY = "pv_city_cache_v1";

function saveCityCache(cityObj){
  try{ localStorage.setItem(CITY_CACHE_KEY, JSON.stringify({ t: Date.now(), city: cityObj })); }catch(e){}
}
function loadCityCache(){
  try{
    const raw = localStorage.getItem(CITY_CACHE_KEY);
    if (!raw) return null;
    const j = JSON.parse(raw);
    return j?.city || null;
  }catch(e){ return null; }
}

async function fetchJson(url){
  const res = await fetch(url, { cache:"no-store" });
  if (!res.ok) throw new Error("fetch fail");
  return res.json();
}

async function resolveCityByIP(){
  // 1) tenta cache primeiro (bom pra quando a internet oscila)
  const cached = loadCityCache();
  if (cached?.lat && cached?.lon){
    CITY = cached;
    document.getElementById("subtitle").textContent = (CITY.state === "ES") ? "LOCAL • ES" : "LOCAL";
  }

  // 2) provedor A: ipapi.co
  try{
    const j = await fetchJson("https://ipapi.co/json/");
    const lat = Number(j.latitude);
    const lon = Number(j.longitude);
    const city = (j.city || "").trim();
    const region = (j.region_code || j.region || "").trim();
    if (!Number.isFinite(lat) || !Number.isFinite(lon)) throw new Error("coords inválidas");

    const name = city ? `${city}${region ? " • " + region : ""}` : (region || "LOCAL");
    CITY = { name, lat, lon, state: region || "" };

    document.getElementById("subtitle").textContent = (CITY.state === "ES") ? "LOCAL • ES" : "LOCAL";
    saveCityCache(CITY);
    return;
  }catch(e){ /* cai pro próximo */ }

  // 3) provedor B: ipwho.is (costuma funcionar quando ipapi falha)
  try{
    const j = await fetchJson("https://ipwho.is/");
    if (j.success === false) throw new Error("ipwho fail");

    const lat = Number(j.latitude);
    const lon = Number(j.longitude);
    const city = (j.city || "").trim();
    const region = (j.region_code || j.region || "").trim();
    if (!Number.isFinite(lat) || !Number.isFinite(lon)) throw new Error("coords inválidas");

    const name = city ? `${city}${region ? " • " + region : ""}` : (region || "LOCAL");
    CITY = { name, lat, lon, state: region || "" };

    document.getElementById("subtitle").textContent = (CITY.state === "ES") ? "LOCAL • ES" : "LOCAL";
    saveCityCache(CITY);
    return;
  }catch(e){ /* fallback final */ }

  // 4) se tudo falhar: fica com cache (se houver) ou fallback fixo
  if (cached?.lat && cached?.lon){
    CITY = cached;
    document.getElementById("subtitle").textContent = (CITY.state === "ES") ? "LOCAL • ES" : "LOCAL";
    return;
  }

  CITY = { ...FALLBACK_CITY };
  document.getElementById("subtitle").textContent = "LOCAL • ES";
}


    // boot
    showA();
    (async ()=>{
      try{ await resolveCityByIP(); }
      catch(e){
        CITY = { ...FALLBACK_CITY };
        document.getElementById("subtitle").textContent = "LOCAL • ES";
      }

      try{ await loadWeather(); }
      catch(err){
        document.getElementById("descToday").textContent = "SEM CONEXÃO";
        document.getElementById("cityName").textContent = CITY.name || "—";
        document.getElementById("footUpdated").textContent = "ATUALIZADO • —";
        console.error(err);
      }

      setInterval(()=>loadWeather().catch(()=>{}), 1000 * 60 * WEATHER_REFRESH_MIN);
    })();
  </script>
</body>
</html>
